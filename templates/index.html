{% extends "layout.html" %}
{% block content %}
<div class="p-4 bg-white rounded shadow-sm">
  <form id="recommendationForm" method="post" class="mb-4">
    <div class="input-group">
      <input type="text" name="query" id="queryInput" class="form-control" placeholder="ì˜ˆ: íƒˆëª¨, ì˜¤ë©”ê°€3, ë¹„íƒ€ë¯¼D" required>
      <button type="submit" class="btn btn-success" id="submitBtn">
        <span class="btn-text">ì¶”ì²œë°›ê¸°</span>
        <span class="btn-loading d-none">
          <span class="spinner-border spinner-border-sm me-2" role="status"></span>
          ì²˜ë¦¬ì¤‘...
        </span>
      </button>
    </div>
  </form>

  <div id="resultContainer" class="fade-in" style="display: none;">
    <div class="alert alert-info" id="recommendationText" style="white-space: pre-wrap;"></div>
  </div>

  <div class="adsense-placeholder text-center mt-5">
    <p class="text-muted">ğŸ“¢ ì—¬ê¸°ì— Google AdSense ê´‘ê³ ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('recommendationForm');
    const queryInput = document.getElementById('queryInput');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');
    const resultContainer = document.getElementById('resultContainer');
    const recommendationText = document.getElementById('recommendationText');

    // Handle form submission with AJAX
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const query = queryInput.value.trim();
        if (!query) return;

        // Show loading state
        submitBtn.disabled = true;
        btnText.classList.add('d-none');
        btnLoading.classList.remove('d-none');
        resultContainer.style.display = 'none';

        try {
            const response = await fetch('/api/recommendation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: query })
            });

            const data = await response.json();

            if (response.ok) {
                recommendationText.textContent = data.recommendation;
                resultContainer.style.display = 'block';
                resultContainer.classList.add('fade-in');
            } else {
                recommendationText.textContent = data.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                resultContainer.style.display = 'block';
            }
        } catch (error) {
            recommendationText.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            resultContainer.style.display = 'block';
        } finally {
            // Reset loading state
            submitBtn.disabled = false;
            btnText.classList.remove('d-none');
            btnLoading.classList.add('d-none');
        }
    });

    // Handle traditional form submission as fallback
    form.addEventListener('submit', function(e) {
        if (!window.fetch) {
            // Fallback for older browsers
            return;
        }
    });
});
</script>
{% endblock %}

